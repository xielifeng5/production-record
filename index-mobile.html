<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4A5568">
    <meta name="description" content="æèŠ±ç»‡ç‰©ç”Ÿäº§è®°å½•ä¸ç®¡ç†ç³»ç»Ÿ">
    <title>æèŠ±ç»‡ç‰©ç”Ÿäº§è®°å½•ç³»ç»Ÿ</title>

    <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

    <!-- æ ¹æ®è®¾å¤‡è‡ªåŠ¨åŠ è½½æ ·å¼ -->
    <script>
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function detectDevice() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const userAgent = navigator.userAgent.toLowerCase();
            
            // iPad 12.9å¯¸æ£€æµ‹ (1024x1366 æˆ–æ›´å¤§)
            if ((width >= 1024 && height >= 1366) || (width >= 1366 && height >= 1024)) {
                return 'ipad';
            }
            // å…¶ä»–è®¾å¤‡ä½¿ç”¨æ‰‹æœºç‰ˆ
            return 'mobile';
        }
        
        // åŠ è½½å¯¹åº”æ ·å¼
        const device = detectDevice();
        const styleLink = document.createElement('link');
        styleLink.rel = 'stylesheet';
        styleLink.href = device === 'ipad' ? 'styles-ipad.css' : 'styles-mobile.css';
        document.head.appendChild(styleLink);
        
        console.log('æ£€æµ‹åˆ°è®¾å¤‡ç±»å‹:', device);
    </script>
</head>
	<body>
	    <div class="container">
	        <!-- ç¼–è¾‘çŠ¶æ€æç¤º -->
	        <div id="editorStatus" style="margin-bottom: 8px; font-size: 14px; color: #4A5568;"></div>

	        <!-- Stack ç”»å»Šï¼ˆç¬¬ 1 å±‚ï¼‰ -->
	        <div id="stacksView" style="display: none;">
	            <div class="stacks-header-mobile">
	                <h2>ğŸ“š å †ç”»å»Š</h2>
	                <button class="btn-secondary" onclick="app.createStack()">â• æ–°å»ºå †</button>
	            </div>
	            <div id="stacksContainer" class="stacks-container">
	                <!-- å †å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
	            </div>
	        </div>

	        <!-- ç¬¬ 3 å±‚ï¼šEP å¤šé¡µç¼–è¾‘å™¨ -->
	        <!-- ç¼–è¾‘å™¨é¡¶éƒ¨å·¥å…·æ ï¼ˆè¿”å›æŒ‰é’® + æ ‡é¢˜ï¼‰ -->
	        <div id="editorToolbar" class="editor-toolbar" style="display: none;">
	            <div class="editor-toolbar-left">
	                <button class="toolbar-back-btn" type="button" onclick="app.backToStackRecords()">â† è¿”å›</button>
	                <div class="editor-toolbar-titles">
	                    <h2 id="editorTitle">ç¼–è¾‘è®°å½•</h2>
	                    <span id="editorSubtitle" class="editor-subtitle">EPå¤šé¡µç¼–è¾‘å™¨</span>
	                </div>
	            </div>
	            <div class="editor-toolbar-right">
	                <button class="toolbar-icon-btn" type="button" onclick="app.saveAllPages()">ğŸ’¾</button>
	            </div>
	        </div>

	        <!-- é¡µé¢å¯¼èˆªæŒ‡ç¤ºå™¨ï¼ˆå¤šé¡µåˆ‡æ¢ï¼‰ -->
	        <div id="pagesNavigation" class="pages-navigation" style="display: none;">
	            <button class="page-nav-btn prev" type="button" onclick="app.goToPrevPage()">â€¹</button>
	            <div id="pageIndicators" class="page-indicators">
	                <!-- é¡µé¢æŒ‡ç¤ºç‚¹å°†åŠ¨æ€ç”Ÿæˆ -->
	            </div>
	            <button class="page-nav-btn next" type="button" onclick="app.goToNextPage()">â€º</button>
	        </div>

	        <!-- é¡µé¢å®¹å™¨ -->
	        <div id="pagesContainer"></div>

		        <!-- åº•éƒ¨æ“ä½œæ  -->
		        <div class="bottom-actions">
		            <button class="btn-primary" onclick="app.addPage()">â• å¢åŠ é¡µ</button>
		            <button class="btn-success" onclick="app.saveAllPages()">ğŸ’¾ ä¿å­˜æ‰€æœ‰é¡µ</button>
		            <button class="btn-secondary" onclick="app.backToStackRecords()">ğŸ“‹ è¿”å›åˆ—è¡¨</button>
		        </div>
		        
		        <!-- å†å²è®°å½•åˆ—è¡¨ï¼ˆç¬¬ 2 å±‚ï¼šå †å†…è®°å½•ç”»å»Šï¼‰ -->
		        <div id="recordsList" class="records-view" style="display: none;">
		            <div class="records-header stack-toolbar">
		                <div class="stack-toolbar-left">
		                    <button class="toolbar-back-btn" type="button" onclick="app.showStacksView()">â† å †</button>
		                    <div class="stack-toolbar-titles">
		                        <h2 id="stackTitle">æœªåˆ†ç»„</h2>
		                        <span id="stackSubtitle" class="stack-subtitle">è®°å½•</span>
		                    </div>
		                </div>
		                <div class="stack-toolbar-right">
		                    <button class="toolbar-icon-btn" type="button">é€‰æ‹©</button>
		                    <button class="toolbar-icon-btn" type="button" onclick="app.exportData()">å¯¼å‡º</button>
		                    <button class="toolbar-icon-btn primary" type="button" onclick="app.startNewRecord()">ï¼‹</button>
		                </div>
		            </div>
		            <div class="records-search-row">
		                <div class="search-bar">
		                    <input type="text" id="searchInput" placeholder="æœç´¢è®°å½•...">
		                    <button type="button" onclick="app.searchRecords()">ğŸ”</button>
		                </div>
		            </div>
		            <div id="recordsContainer" class="records-grid"></div>
		        </div>
	    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div id="modal">
        <div class="modal-content">
            <div id="modalBody"></div>
        </div>
    </div>
    
	    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
	    <input type="file" id="epImageInput" accept="image/*" style="display: none;">
	    <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
	    <input type="file" id="videoInput" accept="video/*" capture="environment" style="display: none;">
	    <input type="file" id="audioInput" accept="audio/*" capture="microphone" style="display: none;">
    
    <!-- è„šæœ¬æ–‡ä»¶ -->
    <script src="database.js"></script>
    <script src="media.js"></script>
    <script src="app.js"></script>
    
	    <script>
	        // ç§»åŠ¨ç«¯é¢å¤–å¢å¼ºé€»è¾‘ï¼ˆApp å®ä¾‹åœ¨ app.js ä¸­å·²åˆ›å»ºä¸ºå…¨å±€å¸¸é‡ appï¼‰

	        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­ï¼ˆç²¾ç¡®åˆ°æ¨¡æ€æ¡†åŒºåŸŸï¼‰
	        document.getElementById('modal').addEventListener('click', function(e) {
	            if (e.target === this) {
	                app.closeModal();
	            }
	        });
	
	        // é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶çš„æ©¡çš®ç­‹æ•ˆæœï¼ˆiOSï¼‰
	        document.body.addEventListener('touchmove', function(e) {
	            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
	                const scrollable = e.target.closest('.modal-content, #recordsContainer');
	                if (!scrollable) {
	                    e.preventDefault();
	                }
	            }
	        }, { passive: false });
	
	        // æ³¨å†ŒService Worker (PWAæ”¯æŒ)
	        if ('serviceWorker' in navigator) {
	            window.addEventListener('load', () => {
	                navigator.serviceWorker.register('./service-worker.js')
	                    .then(reg => console.log('âœ… Service Worker å·²æ³¨å†Œ'))
	                    .catch(err => console.log('âŒ Service Worker æ³¨å†Œå¤±è´¥:', err));
	            });
	        }
	
	        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
	        console.log('å±å¹•å°ºå¯¸:', window.innerWidth, 'x', window.innerHeight);
	        console.log('è®¾å¤‡åƒç´ æ¯”:', window.devicePixelRatio);
	    </script>
</body>
</html>

